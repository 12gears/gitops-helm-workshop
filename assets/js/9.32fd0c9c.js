(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{270:function(s,a,t){"use strict";t.r(a);var e=t(38),n=Object(e.a)({},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[s._v("#")]),s._v(" Prerequisites")]),s._v(" "),t("p",[s._v("In order to install the workshop prerequisites you'll need a Kubernetes cluster "),t("strong",[s._v("1.13")]),s._v("\nor newer with "),t("strong",[s._v("Load Balancer")]),s._v(" support and "),t("strong",[s._v("RBAC")]),s._v(" enabled.\nMake sure you have the following tools installed locally:")]),s._v(" "),t("ul",[t("li",[s._v("kubectl 1.14")]),s._v(" "),t("li",[s._v("git 2.20")])]),s._v(" "),t("h2",{attrs:{id:"helm-v3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-v3","aria-hidden":"true"}},[s._v("#")]),s._v(" Helm v3")]),s._v(" "),t("p",[s._v("Download the Helm v3 CLI:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("darwin-amd64 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.helm3/bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://get.helm.sh/helm-v3.0.0-beta.3-'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${OS}")]),s._v('.tar.gz"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xvz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${OS}")]),s._v("/helm "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${OS}")]),s._v("/helm "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.helm3/bin/helmv3\n")])])]),t("p",[s._v("Add the helmv3 binary to your path and set Helm home:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.helm3/bin\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HELM_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.helm3\n")])])]),t("p",[s._v("Verify the installation with:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helmv3 version\n")])])]),t("h2",{attrs:{id:"git"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#git","aria-hidden":"true"}},[s._v("#")]),s._v(" Git")]),s._v(" "),t("p",[s._v("Fork the "),t("a",{attrs:{href:"https://github.com/stefanprodan/gitops-helm-workshop",target:"_blank",rel:"noopener noreferrer"}},[s._v("workshop"),t("OutboundLink")],1),s._v(" repository\nand clone it locally (replace the "),t("code",[s._v("GHUSER")]),s._v(" value with your GitHub username):")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GHUSER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("stefanprodan\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GHUSER}")]),s._v("/gitops-helm-workshop\n")])])]),t("p",[s._v("Set your GitHub username and email:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" gitops-helm-workshop\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config user.name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GHUSER}")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config user.email "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your@main.address"')]),s._v("\n")])])]),t("p",[s._v("Cluster state directory structure:")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("├── cluster\n    ├── canaries\n    ├── charts\n    │   └── podinfo\n    ├── namespaces\n    └── releases\n")])])]),t("h2",{attrs:{id:"flux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flux","aria-hidden":"true"}},[s._v("#")]),s._v(" Flux")]),s._v(" "),t("p",[s._v("Add FluxCD repository to Helm repos:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helmv3 repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" fluxcd https://charts.fluxcd.io\n")])])]),t("p",[s._v("Create the fluxcd namespace:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl create ns fluxcd\n")])])]),t("p",[s._v("Install Flux by providing your GitHub repository URL:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helmv3 upgrade -i flux fluxcd/flux --wait "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--namespace fluxcd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set registry.pollInterval"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1m "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set git.pollInterval"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1m "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set git.url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("git@github.com:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GHUSER}")]),s._v("/gitops-helm-workshop\n")])])]),t("p",[s._v("Install fluxctl:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# macOS and linux")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sL https://fluxcd.io/install "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.fluxcd/bin\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# windows")]),s._v("\nhttps://github.com/fluxcd/flux/releases\n")])])]),t("p",[s._v("Find the Git SSH public key:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLUX_FORWARD_NAMESPACE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fluxcd\n\nfluxctl identity\n")])])]),t("p",[s._v("Copy the public key and create a deploy key with write access on your GitHub repository.\nGo to "),t("code",[s._v("Settings > Deploy keys")]),s._v(" click on "),t("code",[s._v("Add deploy key")]),s._v(", check "),t("code",[s._v("Allow write access")]),s._v(",\npaste the Flux public key and click "),t("code",[s._v("Add key")]),s._v(".")]),s._v(" "),t("h2",{attrs:{id:"helm-operator"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-operator","aria-hidden":"true"}},[s._v("#")]),s._v(" Helm Operator")]),s._v(" "),t("p",[s._v("Install the HelmRelease CRD:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl apply -f https://raw.githubusercontent.com/fluxcd/helm-operator/helm-v3/deploy/flux-helm-release-crd.yaml\n")])])]),t("p",[s._v("Install Flux Helm Operator in the "),t("code",[s._v("fluxcd")]),s._v(" namespace:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helmv3 upgrade -i helm-operator fluxcd/helm-operator --wait "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--namespace fluxcd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set git.ssh.secretName"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("flux-git-deploy "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set git.pollInterval"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1m "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("chartsSyncInterval")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1m "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set configureRepositories.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set configureRepositories.repositories"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("stable "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set configureRepositories.repositories"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://kubernetes-charts.storage.googleapis.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set extraEnvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("HELM_VERSION "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set extraEnvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".value"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v3 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set image.repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker.io/fluxcd/helm-operator-prerelease "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set image.tag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("helm-v3-71bc9d62\n")])])]),t("h2",{attrs:{id:"linkerd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linkerd","aria-hidden":"true"}},[s._v("#")]),s._v(" Linkerd")]),s._v(" "),t("p",[s._v("Download the Linkerd v2 CLI:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# macOS and linux")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sL https://run.linkerd.io/install "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.linkerd2/bin\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# windows")]),s._v("\nhttps://github.com/linkerd/linkerd2/releases\n")])])]),t("p",[s._v("Install the Linkerd control plane in the "),t("code",[s._v("linkerd")]),s._v(" namespace:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("linkerd "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl apply -f -\n")])])]),t("p",[s._v("Validate the install with:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("linkerd check\n")])])]),t("h2",{attrs:{id:"flagger"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flagger","aria-hidden":"true"}},[s._v("#")]),s._v(" Flagger")]),s._v(" "),t("p",[s._v("Add Flagger Helm repository:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helmv3 repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" flagger https://flagger.app\n")])])]),t("p",[s._v("Install Flagger's Canary CRD:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl apply -f https://raw.githubusercontent.com/weaveworks/flagger/master/artifacts/flagger/crd.yaml\n")])])]),t("p",[s._v("Install Flagger in the "),t("code",[s._v("linkerd")]),s._v(" namespace:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helmv3 upgrade -i flagger flagger/flagger --wait "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--namespace linkerd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set crd.create"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("metricsServer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://linkerd-prometheus:9090 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("meshProvider")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linkerd\n")])])])])},[],!1,null,null,null);a.default=n.exports}}]);